version: '3.7'
services:
  # http-proxy:
  #   deploy:
  #     labels:
  #       kompose.image-pull-policy: true
  #     placement:
  #       constraints:
  #         - node.labels.role == node-as
  #   volumes:
  #     - ./gtas-parent/gtas-commons/certs:/
  # web-app:
  #   environment:
  #     JAVA_TOOL_OPTIONS: "-XX:+IgnoreUnrecognizedVMOptions -XX:+UseContainerSupport"
  #     # JAVA_OPTS: "-Xms4g -Xmx8g -XX:MaxPermSize=16g -Duser.timezone=UTC"
  #     EMAIL_SENDER_USERNAME: ""
  #     EMAIL_SENDER_PASSWORD: ""
  #     EMAIL_SENDER_HOST: ""
  #     SSL_TRUST_HOST: ""
  #     AUTOMATED_HIT_NOTIFICATION_EMAIL_ENABLED: "false"
  #     MANUAL_HIT_NOTIFICATION_EMAIL_ENABLED: "false"
  #     PROXY_IP: ""
  #   deploy:
  #     labels:
  #       kompose.image-pull-policy: true
  #     placement:
  #       constraints:
  #         - node.labels.role == node-as
  #   volumes:
  #     - ./gtas-parent/gtas-commons/certs:/usr/local/tomcat/conf
  # gtas-scheduler:
  #   environment:
  #     JAVA_TOOL_OPTIONS: "-XX:+IgnoreUnrecognizedVMOptions -XX:+UseContainerSupport"
  #     # JAVA_OPTS: "-Xms8000m -Xmx16000m -Duser.timezone=UTC -Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom"
  #     EMAIL_SENDER_USERNAME: ""
  #     EMAIL_SENDER_PASSWORD: ""
  #     EMAIL_SENDER_HOST: ""
  #     SSL_TRUST_HOST: ""
  #     AUTOMATED_HIT_NOTIFICATION_EMAIL_ENABLED: "false"
  #     MANUAL_HIT_NOTIFICATION_EMAIL_ENABLED: "false"
  #     PROXY_IP: ""
  #   deploy:
  #     labels:
  #       kompose.image-pull-policy: true
  #     placement:
  #       constraints:
  #         - node.labels.role == node-as
  # activemq:
  #   deploy:
  #     labels:
  #       kompose.image-pull-policy: true
  #     placement:
  #       constraints:
  #         - node.labels.role == node-bs
  # mariadb:
  #   deploy:
  #     labels:
  #       kompose.image-pull-policy: true
  #     placement:
  #       constraints:
  #         - node.labels.role == node-bs
  kibana:
    deploy:
      labels:
        kompose.image-pull-policy: true
      placement:
        constraints:
          - node.labels.role == node-a
    volumes:
      - ./gtas-parent/gtas-commons/certs/:/etc/kibana/config/
  elasticsearch:
    deploy:
      labels:
        kompose.image-pull-policy: true
      placement:
        constraints:
          - node.labels.role == node-b
    volumes:
      - ./gtas-parent/gtas-commons/certs/:/usr/share/elasticsearch/config/certs/elasticsearch/
  logstash:
    deploy:
      labels:
        kompose.image-pull-policy: true
      placement:
        constraints:
          - node.labels.role == node-b
  elk-setup:
    deploy:
      labels:
        kompose.image-pull-policy: true
      placement:
        constraints:
          - node.labels.role == node-b
    volumes:
      - ${PWD}/gtas-parent/gtas-commons/secrets/logstash_keystore_password.txt:/run/secrets/logstash-keystore-password
      - ${PWD}/gtas-parent/gtas-commons/secrets/mysql_logstash_user.txt:/run/secrets/mysql-logstash-user
      - ${PWD}/gtas-parent/gtas-commons/secrets/mysql_logstash_password.txt:/run/secrets/mysql-logstash-password
      - ${PWD}/gtas-parent/gtas-commons/secrets/elastic_password.txt:/run/secrets/elastic-password
      - ${PWD}/gtas-parent/gtas-commons/secrets/elasticsearch_kibana_user.txt:/run/secrets/elasticsearch-kibana-user
      - ${PWD}/gtas-parent/gtas-commons/secrets/elasticsearch_kibana_password.txt:/run/secrets/elasticsearch-kibana-password
      - ${PWD}/gtas-parent/gtas-commons/secrets/elastic_bootstrap_password.txt:/run/secrets/elastic-bootstrap-password
  # neo4j:
  #   deploy:
  #     labels:
  #       kompose.image-pull-policy: true
  #     placement:
  #       constraints:
  #         - node.labels.role == node-as
  # etl-job:
  #   deploy:
  #     labels:
  #       kompose.image-pull-policy: true
  #     placement:
  #       constraints:
  #         - node.labels.role == node-bs

networks:
  gtas_webapp-network:
    driver: "overlay"
    attachable: true